!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("THREE"),require("EXAMPLES")):"function"==typeof define&&define.amd?define(["THREE","EXAMPLES"],e):"object"==typeof exports?exports.ENABLE3D=e(require("THREE"),require("EXAMPLES")):t.ENABLE3D=e(t.THREE,t.EXAMPLES)}(window,(function(t,e){return function(t){var e={};function o(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,o),r.l=!0,r.exports}return o.m=t,o.c=e,o.d=function(t,e,n){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="",o(o.s=3)}([function(e,o){e.exports=t},function(t,e,o){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function i(){}function a(t,e,o){this.fn=t,this.context=e,this.once=o||!1}function s(t,e,o,n,i){if("function"!=typeof o)throw new TypeError("The listener must be a function");var s=new a(o,n||t,i),c=r?r+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],s]:t._events[c].push(s):(t._events[c]=s,t._eventsCount++),t}function c(t,e){0==--t._eventsCount?t._events=new i:delete t._events[e]}function m(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(r=!1)),m.prototype.eventNames=function(){var t,e,o=[];if(0===this._eventsCount)return o;for(e in t=this._events)n.call(t,e)&&o.push(r?e.slice(1):e);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},m.prototype.listeners=function(t){var e=r?r+t:t,o=this._events[e];if(!o)return[];if(o.fn)return[o.fn];for(var n=0,i=o.length,a=new Array(i);n<i;n++)a[n]=o[n].fn;return a},m.prototype.listenerCount=function(t){var e=r?r+t:t,o=this._events[e];return o?o.fn?1:o.length:0},m.prototype.emit=function(t,e,o,n,i,a){var s=r?r+t:t;if(!this._events[s])return!1;var c,m,l=this._events[s],u=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),u){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,o),!0;case 4:return l.fn.call(l.context,e,o,n),!0;case 5:return l.fn.call(l.context,e,o,n,i),!0;case 6:return l.fn.call(l.context,e,o,n,i,a),!0}for(m=1,c=new Array(u-1);m<u;m++)c[m-1]=arguments[m];l.fn.apply(l.context,c)}else{var d,p=l.length;for(m=0;m<p;m++)switch(l[m].once&&this.removeListener(t,l[m].fn,void 0,!0),u){case 1:l[m].fn.call(l[m].context);break;case 2:l[m].fn.call(l[m].context,e);break;case 3:l[m].fn.call(l[m].context,e,o);break;case 4:l[m].fn.call(l[m].context,e,o,n);break;default:if(!c)for(d=1,c=new Array(u-1);d<u;d++)c[d-1]=arguments[d];l[m].fn.apply(l[m].context,c)}}return!0},m.prototype.on=function(t,e,o){return s(this,t,e,o,!1)},m.prototype.once=function(t,e,o){return s(this,t,e,o,!0)},m.prototype.removeListener=function(t,e,o,n){var i=r?r+t:t;if(!this._events[i])return this;if(!e)return c(this,i),this;var a=this._events[i];if(a.fn)a.fn!==e||n&&!a.once||o&&a.context!==o||c(this,i);else{for(var s=0,m=[],l=a.length;s<l;s++)(a[s].fn!==e||n&&!a[s].once||o&&a[s].context!==o)&&m.push(a[s]);m.length?this._events[i]=1===m.length?m[0]:m:c(this,i)}return this},m.prototype.removeAllListeners=function(t){var e;return t?(e=r?r+t:t,this._events[e]&&c(this,e)):(this._events=new i,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=r,m.EventEmitter=m,t.exports=m},function(t,o){t.exports=e},function(t,e,o){"use strict";o.r(e);var n,r,i=function(t){console.error("%c [enable3d] "+t+" ","background: #222; color: #bada55")},a=o(1),s=o.n(a),c=function(){function t(t,e){this.physics=t,this.ammo=e,this.offset={x:0,y:0,z:0},this.errors=[],this.checkCollisions=!1,this.breakable=!1,this.collided=!1,this.didUpdate=!1,this._emitUpdateEvents=!1,this._needUpdate=!1,this.tmpBtVector3=new Ammo.btVector3,this.name=e.name}return t.prototype.setupEventEmitter=function(){void 0===this.eventEmitter&&(this.eventEmitter=new s.a)},Object.defineProperty(t.prototype,"needUpdate",{get:function(){return this._needUpdate},set:function(t){!t&&this._needUpdate&&(this.didUpdate=!0),this._needUpdate=t},enumerable:!0,configurable:!0}),t.prototype.onUpdateEvent=function(t,e){void 0===e&&(e=!1),this.setupEventEmitter(),this._emitUpdateEvents=!0,e?this.eventEmitter.once("update",(function(){t()})):this.eventEmitter.on("update",(function(){t()}))},Object.defineProperty(t.prototype,"on",{get:function(){var t=this;return{update:function(e){return t.onUpdateEvent(e)},collision:function(e){return t.onCollision(e)}}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"once",{get:function(){var t=this;return{update:function(e){return t.onUpdateEvent(e,!0)}}},enumerable:!0,configurable:!0}),t.prototype.onCollision=function(t){var e=this;this.checkCollisions=!0,this.physics.on("collision",(function(o){var n=o.bodies,r=o.event;n[0].name===e.name?t(n[1],r):n[1].name===e.name&&t(n[0],r)}))},Object.defineProperty(t.prototype,"velocity",{get:function(){return{x:this.ammo.getLinearVelocity().x(),y:this.ammo.getLinearVelocity().y(),z:this.ammo.getLinearVelocity().z()}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angularVelocity",{get:function(){return{x:this.ammo.getAngularVelocity().x(),y:this.ammo.getAngularVelocity().y(),z:this.ammo.getAngularVelocity().z()}},enumerable:!0,configurable:!0}),t.prototype.setVelocity=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setVelocityX=function(t){this.tmpBtVector3.setValue(t,this.velocity.y,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setVelocityY=function(t){this.tmpBtVector3.setValue(this.velocity.x,t,this.velocity.z),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setVelocityZ=function(t){this.tmpBtVector3.setValue(this.velocity.x,this.velocity.y,t),this.ammo.setLinearVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocity=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocityX=function(t){this.tmpBtVector3.setValue(t,this.angularVelocity.y,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocityY=function(t){this.tmpBtVector3.setValue(this.angularVelocity.x,t,this.angularVelocity.z),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.setAngularVelocityZ=function(t){this.tmpBtVector3.setValue(this.angularVelocity.x,this.angularVelocity.y,t),this.ammo.setAngularVelocity(this.tmpBtVector3)},t.prototype.applyForce=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyForceX=function(t){this.tmpBtVector3.setValue(t,0,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyForceY=function(t){this.tmpBtVector3.setValue(0,t,0),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.applyForceZ=function(t){this.tmpBtVector3.setValue(0,0,t),this.ammo.applyCentralImpulse(this.tmpBtVector3)},t.prototype.setCollisionFlags=function(t){this.ammo.setCollisionFlags(t)},t.prototype.getCollisionFlags=function(){return this.ammo.getCollisionFlags()},t.prototype.setRestitution=function(t){this.ammo.setRestitution(t)},t.prototype.setBounciness=function(t){this.setRestitution(t)},t.prototype.setLinearFactor=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setLinearFactor(this.tmpBtVector3)},t.prototype.setAngularFactor=function(t,e,o){this.tmpBtVector3.setValue(t,e,o),this.ammo.setAngularFactor(this.tmpBtVector3)},t.prototype.setFriction=function(t){this.ammo.setFriction(t)},t}(),m=function(t,e){e.forEach((function(e){Object.getOwnPropertyNames(e.prototype).forEach((function(o){Object.defineProperty(t.prototype,o,Object.getOwnPropertyDescriptor(e.prototype,o))}))}))},l=function(){return(l=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},u=function(){function t(){this.objectsAmmo={}}return t.prototype.addSphere=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.addSphere(t,e);return this.addExisting(o,t),o},t.prototype.addBox=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.addBox(t,e);return this.addExisting(o,t),o},t.prototype.addGround=function(t,e){void 0===e&&(e={});var o=this.factory.addGround(t,e),n=l(l({},t),{mass:0,collisionFlags:1});return this.addExisting(o,n),o},t.prototype.addCylinder=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.addCylinder(t,e);return this.addExisting(o,t),o},t.prototype.addTorus=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.factory.addTorus(t,e);return this.addExisting(o,t),o},t.prototype.addExtrude=function(t,e){void 0===e&&(e={});var o=this.factory.addExtrude(t,e);return o.translateX(1),this.addExisting(o),o},t}(),d=function(){function t(){}return Object.defineProperty(t.prototype,"addConstraints",{get:function(){var t=this;return{lock:function(e,o){return t.lock(e,o)},fixed:function(e,o){return t.fixed(e,o)},spring:function(e,o,n){return t.spring(e,o,n)},slider:function(e,o){return t.slider(e,o)},hinge:function(e,o,n){return t.hinge(e,o,n)},coneTwist:function(e,o){return t.coneTwist(e,o)},pointToPoint:function(e,o,n){return t.pointToPoint(e,o,n)}}},enumerable:!0,configurable:!0}),t.prototype.getTransform=function(t,e){var o=t.getCenterOfMassTransform().inverse().op_mul(e.getWorldTransform()),n=new Ammo.btTransform;return n.setIdentity(),{body:o,target:n}},t.prototype.lock=function(t,e){var o=this.getTransform(t.ammo,e.ammo),n=new Ammo.btGeneric6DofConstraint(t.ammo,e.ammo,o.body,o.target,!0),r=new Ammo.btVector3(0,0,0);n.setLinearLowerLimit(r),n.setLinearUpperLimit(r),n.setAngularLowerLimit(r),n.setAngularUpperLimit(r),this.physicsWorld.addConstraint(n)},t.prototype.fixed=function(t,e){var o=this.getTransform(t.ammo,e.ammo);o.body.setRotation(t.ammo.getWorldTransform().getRotation()),o.target.setRotation(e.ammo.getWorldTransform().getRotation());var n=new Ammo.btFixedConstraint(t.ammo,e.ammo,o.body,o.target);this.physicsWorld.addConstraint(n)},t.prototype.spring=function(t,e,o){void 0===o&&(o={});var n=o.stiffness,r=void 0===n?50:n,i=o.damping,a=void 0===i?.01:i,s=o.angularLock,c=void 0!==s&&s,m=this.getTransform(t.ammo,e.ammo),l=new Ammo.btGeneric6DofSpringConstraint(t.ammo,e.ammo,m.body,m.target,!0);l.setLinearLowerLimit(new Ammo.btVector3(-100,-100,-100)),l.setLinearUpperLimit(new Ammo.btVector3(100,100,100)),c&&(l.setAngularLowerLimit(new Ammo.btVector3(0,0,0)),l.setAngularUpperLimit(new Ammo.btVector3(0,0,0)));for(var u=0;u<3;u++)l.enableSpring(u,!0),l.setStiffness(u,r),l.setDamping(u,a);this.physicsWorld.addConstraint(l)},t.prototype.slider=function(t,e){var o=this.getTransform(t.ammo,e.ammo),n=new Ammo.btSliderConstraint(t.ammo,e.ammo,o.body,o.target,!0);n.setLowerLinLimit(-1),n.setUpperLinLimit(1),this.physicsWorld.addConstraint(n)},t.prototype.hinge=function(t,e,o){void 0===o&&(o={});var n=o.pivot,r=o.targetPivot,i=o.axis,a=o.targetAxis,s=new Ammo.btVector3((null==n?void 0:n.x)||0,(null==n?void 0:n.y)||0,(null==n?void 0:n.z)||0),c=new Ammo.btVector3((null==r?void 0:r.x)||0,(null==r?void 0:r.y)||0,(null==r?void 0:r.z)||0),m=new Ammo.btVector3((null==i?void 0:i.x)||0,(null==i?void 0:i.y)||0,(null==i?void 0:i.z)||1),l=new Ammo.btVector3((null==a?void 0:a.x)||0,(null==a?void 0:a.y)||0,(null==a?void 0:a.z)||1),u=new Ammo.btHingeConstraint(t.ammo,e.ammo,s,c,m,l,!0);this.physicsWorld.addConstraint(u)},t.prototype.coneTwist=function(t,e){void 0===e&&(e={});var o=new Ammo.btTransform;o.setIdentity(),o.getOrigin().setValue((null==e?void 0:e.x)||0,(null==e?void 0:e.y)||0,(null==e?void 0:e.z)||0);var n=new Ammo.btConeTwistConstraint(t.ammo,o);this.physicsWorld.addConstraint(n)},t.prototype.pointToPoint=function(t,e,o){void 0===o&&(o={});var n=o.pivot,r=o.targetPivot,i=new Ammo.btVector3((null==n?void 0:n.x)||0,(null==n?void 0:n.y)||0,(null==n?void 0:n.z)||0),a=new Ammo.btVector3((null==r?void 0:r.x)||0,(null==r?void 0:r.y)||0,(null==r?void 0:r.z)||0),s=new Ammo.btPoint2PointConstraint(t.ammo,e.ammo,i,a);this.physicsWorld.addConstraint(s)},t}(),p=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return p(e,t),e.prototype.addCollider=function(t,e,o){t.body&&e.body&&(t.body.checkCollisions=!0,e.body.checkCollisions=!0,this.on("collision",(function(n){var r,i,a=n.bodies,s=n.event;(null===(r=a[0])||void 0===r?void 0:r.name)&&(null===(i=a[1])||void 0===i?void 0:i.name)&&(null==t?void 0:t.name)&&(null==e?void 0:e.name)&&(a[0].name===t.name&&a[1].name===e.name||a[1].name===t.name&&a[0].name===e.name)&&o(s)})))},e}(s.a),f=o(0),y=1,b=32768,v=function(){function t(t,e,o){void 0===o&&(o={}),this.scene=t,this.world=e,this.options=o,this.debugDrawMode=o.debugDrawMode||y;var n=this.debugDrawMode&b||!1,r=o.maxBufferSize||1e6;this.geometry=new f.BufferGeometry;var i=new Float32Array(3*r),a=new Float32Array(3*r);this.geometry.setAttribute("position",new f.BufferAttribute(i,3).setUsage(f.StaticDrawUsage)),this.geometry.setAttribute("color",new f.BufferAttribute(a,3).setUsage(f.StaticDrawUsage)),this.index=0;var s=new f.LineBasicMaterial({vertexColors:f.VertexColors,depthTest:!n});this.mesh=new f.LineSegments(this.geometry,s),n&&(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.world.setDebugDrawer(this.debugDrawer)}return t.prototype.enable=function(){this.enabled=!0,this.scene.add(this.mesh)},t.prototype.disable=function(){this.enabled=!1,this.scene.remove(this.mesh)},t.prototype.update=function(){this.enabled&&(0!=this.index&&(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))},t.prototype.drawLine=function(t,e,o){var n=Ammo.HEAPF32,r=n[(o+0)/4],i=n[(o+4)/4],a=n[(o+8)/4],s=n[(t+0)/4],c=n[(t+4)/4],m=n[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,s,c,m),this.geometry.attributes.color.setXYZ(this.index++,r,i,a);var l=n[(e+0)/4],u=n[(e+4)/4],d=n[(e+8)/4];this.geometry.attributes.position.setXYZ(this.index,l,u,d),this.geometry.attributes.color.setXYZ(this.index++,r,i,a)},t.prototype.drawContactPoint=function(t,e,o,n,r){var i=Ammo.HEAPF32,a=i[(r+0)/4],s=i[(r+4)/4],c=i[(r+8)/4],m=i[(t+0)/4],l=i[(t+4)/4],u=i[(t+8)/4];this.geometry.attributes.position.setXYZ(this.index,m,l,u),this.geometry.attributes.color.setXYZ(this.index++,a,s,c);var d=i[(e+0)/4]*o,p=i[(e+4)/4]*o,h=i[(e+8)/4]*o;this.geometry.attributes.position.setXYZ(this.index,m+d,l+p,u+h),this.geometry.attributes.color.setXYZ(this.index++,a,s,c)},t.prototype.reportErrorWarning=function(t){Ammo.hasOwnProperty("Pointer_stringify")?console.warn(Ammo.Pointer_stringify(t)):this.warnedOnce||(this.warnedOnce=!0,console.warn("Cannot print warningString, please rebuild Ammo.js using 'debug' flag"))},t.prototype.draw3dText=function(t,e){console.warn("TODO: draw3dText")},t.prototype.setDebugMode=function(t){this.debugDrawMode=t},t.prototype.getDebugMode=function(){return this.debugDrawMode},t}(),g=o(2),w=function(t,e){this.minSizeForBreak=t||1.4,this.smallDelta=e||1e-4,this.tempLine1=new f.Line3,this.tempPlane1=new f.Plane,this.tempPlane2=new f.Plane,this.tempPlane_Cut=new f.Plane,this.tempCM1=new f.Vector3,this.tempCM2=new f.Vector3,this.tempVector3=new f.Vector3,this.tempVector3_2=new f.Vector3,this.tempVector3_3=new f.Vector3,this.tempVector3_P0=new f.Vector3,this.tempVector3_P1=new f.Vector3,this.tempVector3_P2=new f.Vector3,this.tempVector3_N0=new f.Vector3,this.tempVector3_N1=new f.Vector3,this.tempVector3_AB=new f.Vector3,this.tempVector3_CB=new f.Vector3,this.tempResultObjects={object1:null,object2:null},this.segments=[];for(var o=0;o<900;o++)this.segments[o]=!1};w.prototype={constructor:w,prepareBreakableObject:function(t,e,o,n,r){t.geometry.isBufferGeometry||console.error("THREE.ConvexObjectBreaker.prepareBreakableObject(): Parameter object must have a BufferGeometry.");var i=t.userData;i.mass=e,i.velocity=o.clone(),i.angularVelocity=n.clone(),i.breakable=r},subdivideByImpact:function(t,e,o,n,r){var i=[],a=this.tempPlane1,s=this.tempPlane2;this.tempVector3.addVectors(e,o),a.setFromCoplanarPoints(e,t.position,this.tempVector3);var c=r+n,m=this;return function r(l,u,d,p){if(Math.random()<.05*p||p>c)i.push(l);else{var h=Math.PI;0===p?(s.normal.copy(a.normal),s.constant=a.constant):p<=n?(h=(d-u)*(.2+.6*Math.random())+u,m.tempVector3_2.copy(t.position).sub(e).applyAxisAngle(o,h).add(e),s.setFromCoplanarPoints(e,m.tempVector3,m.tempVector3_2)):(h=(.5*(1&p)+.2*(2-Math.random()))*Math.PI,m.tempVector3_2.copy(e).sub(l.position).applyAxisAngle(o,h).add(l.position),m.tempVector3_3.copy(o).add(l.position),s.setFromCoplanarPoints(l.position,m.tempVector3_3,m.tempVector3_2)),m.cutByPlane(l,s,m.tempResultObjects);var f=m.tempResultObjects.object1,y=m.tempResultObjects.object2;f&&r(f,u,h,p+1),y&&r(y,h,d,p+1)}}(t,0,2*Math.PI,0),i},cutByPlane:function(t,e,o){var n=t.geometry,r=n.attributes.position.array,a=n.attributes.normal.array,s=r.length/3,c=s/3,m=n.getIndex();function l(t,e){var o=3*t+e;return m?m[o]:o}m&&(c=(m=m.array).length/3);for(var u=[],d=[],p=this.smallDelta,h=s*s,y=0;y<h;y++)this.segments[y]=!1;var b=this.tempVector3_P0,v=this.tempVector3_P1,x=this.tempVector3_N0,A=this.tempVector3_N1;for(y=0;y<c-1;y++){var V=l(y,0),P=l(y,1),_=l(y,2);x.set(a[V],a[V]+1,a[V]+2);for(var C=y+1;C<c;C++){var O=l(C,0),M=l(C,1),S=l(C,2);A.set(a[O],a[O]+1,a[O]+2),1-x.dot(A)<p&&(V===O||V===M||V===S?P===O||P===M||P===S?(this.segments[V*s+P]=!0,this.segments[P*s+V]=!0):(this.segments[_*s+V]=!0,this.segments[V*s+_]=!0):P!==O&&P!==M&&P!==S||(this.segments[_*s+P]=!0,this.segments[P*s+_]=!0))}}var B=this.tempPlane_Cut;t.updateMatrix(),w.transformPlaneToLocalSpace(e,t.matrix,B);for(y=0;y<c;y++)for(var E=l(y,0),j=l(y,1),D=l(y,2),T=0;T<3;T++){var k=0===T?E:1===T?j:D,z=0===T?j:1===T?D:E;if(!this.segments[k*s+z]){this.segments[k*s+z]=!0,this.segments[z*s+k]=!0,b.set(r[3*k],r[3*k+1],r[3*k+2]),v.set(r[3*z],r[3*z+1],r[3*z+2]);var L=0;(H=B.distanceToPoint(b))>p?(L=2,d.push(b.clone())):H<-p?(L=1,u.push(b.clone())):(L=3,u.push(b.clone()),d.push(b.clone()));var H,I=0;if((H=B.distanceToPoint(v))>p?(I=2,d.push(v.clone())):H<-p?(I=1,u.push(v.clone())):(I=3,u.push(v.clone()),d.push(v.clone())),1===L&&2===I||2===L&&1===I){this.tempLine1.start.copy(b),this.tempLine1.end.copy(v);var R=new f.Vector3;if(void 0===(R=B.intersectLine(this.tempLine1,R)))return console.error("Internal error: segment does not intersect plane."),o.segmentedObject1=null,o.segmentedObject2=null,0;u.push(R),d.push(R.clone())}}}var F=.5*t.userData.mass;this.tempCM1.set(0,0,0);var W=0,N=u.length;if(N>0){for(y=0;y<N;y++)this.tempCM1.add(u[y]);this.tempCM1.divideScalar(N);for(y=0;y<N;y++){(X=u[y]).sub(this.tempCM1),W=Math.max(W,X.x,X.y,X.z)}this.tempCM1.add(t.position)}this.tempCM2.set(0,0,0);var G=0,U=d.length;if(U>0){for(y=0;y<U;y++)this.tempCM2.add(d[y]);this.tempCM2.divideScalar(U);for(y=0;y<U;y++){var X;(X=d[y]).sub(this.tempCM2),G=Math.max(G,X.x,X.y,X.z)}this.tempCM2.add(t.position)}var q=null,Q=null,Y=0;if(N>4)try{(q=new f.Mesh(new g.ConvexBufferGeometry(u),t.material)).position.copy(this.tempCM1),q.quaternion.copy(t.quaternion),this.prepareBreakableObject(q,F,t.userData.velocity,t.userData.angularVelocity,2*W>this.minSizeForBreak),Y++}catch(t){i("Error in ConvexObjectBreaker.ts")}if(U>4)try{(Q=new f.Mesh(new g.ConvexBufferGeometry(d),t.material)).position.copy(this.tempCM2),Q.quaternion.copy(t.quaternion),this.prepareBreakableObject(Q,F,t.userData.velocity,t.userData.angularVelocity,2*G>this.minSizeForBreak),Y++}catch(t){i("Error in ConvexObjectBreaker.ts")}return o.object1=q,o.object2=Q,Y}},w.transformFreeVector=function(t,e){var o=t.x,n=t.y,r=t.z,i=e.elements;return t.x=i[0]*o+i[4]*n+i[8]*r,t.y=i[1]*o+i[5]*n+i[9]*r,t.z=i[2]*o+i[6]*n+i[10]*r,t},w.transformFreeVectorInverse=function(t,e){var o=t.x,n=t.y,r=t.z,i=e.elements;return t.x=i[0]*o+i[1]*n+i[2]*r,t.y=i[4]*o+i[5]*n+i[6]*r,t.z=i[8]*o+i[9]*n+i[10]*r,t},w.transformTiedVectorInverse=function(t,e){var o=t.x,n=t.y,r=t.z,i=e.elements;return t.x=i[0]*o+i[1]*n+i[2]*r-i[12],t.y=i[4]*o+i[5]*n+i[6]*r-i[13],t.z=i[8]*o+i[9]*n+i[10]*r-i[14],t},w.transformPlaneToLocalSpace=(r=new f.Vector3,function(t,e,o){o.normal.copy(t.normal),o.constant=t.constant;var n=w.transformTiedVectorInverse(t.coplanarPoint(r),e);w.transformFreeVectorInverse(o.normal,e),o.constant=-n.dot(o.normal)});
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/yandeu/enable3d
 * @license      {@link https://github.com/yandeu/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
var x=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),A=function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<o;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)n[r]=i[a];return n},V=function(t){function e(e,o){void 0===o&&(o={});var n=t.call(this)||this;return n.scene=e,n.config=o,n.rigidBodies=[],n.objectsAmmo={},n.earlierDetectedCollisions=[],n}return x(e,t),e.prototype.setup=function(){this.convexBreaker=new w,this.objectsToRemove=[],this.numObjectsToRemove=0;for(var t=0;t<500;t++)this.objectsToRemove[t]=null;this.setupPhysicsWorld(),this.debugDrawer=new v(this.scene,this.physicsWorld,{})},e.prototype.updateDebugger=function(){this.debugDrawer&&this.debugDrawer.enabled&&this.debugDrawer.update()},e.prototype.setupPhysicsWorld=function(){var t=this.gravity,e=new Ammo.btDefaultCollisionConfiguration,o=new Ammo.btCollisionDispatcher(e),n=new Ammo.btDbvtBroadphase,r=new Ammo.btSequentialImpulseConstraintSolver;this.physicsWorld=new Ammo.btDiscreteDynamicsWorld(o,n,r,e),this.physicsWorld.setGravity(new Ammo.btVector3(t.x,t.y,t.z)),this.dispatcher=o,this.tmpTrans=new Ammo.btTransform},e.prototype.createDebrisFromBreakableObject=function(t,e){t.material=this.defaultMaterial.get(),t.shape="hull",t.fragmentDepth=e.fragmentDepth+1,this.scene.add(t),this.addExisting(t),t.body.breakable=!1,setTimeout((function(){t.body.breakable=!0}),2500)},e.prototype.removeDebris=function(t){this.scene.remove(t),this.physicsWorld.removeRigidBody(t.body.ammo),delete this.objectsAmmo[t.ptr]},e.prototype.update=function(t){var e,o,n=this;this.impactPoint.set(0,0,0),this.impactNormal.set(0,0,0);var r=[],i=t/1e3;this.physicsWorld.stepSimulation(i,this.config.maxSubSteps||1,this.config.fixedTimeStep||1/60);for(var a=0,s=this.rigidBodies.length;a<s;a++){var c=this.rigidBodies[a],m=c.body.ammo.getMotionState();if(m){if(m.getWorldTransform(this.tmpTrans),c.body.didUpdate&&(c.body._emitUpdateEvents&&c.body.eventEmitter.emit("update"),c.body.didUpdate=!1),c.body.ammo.isKinematicObject()&&c.body.needUpdate)c.getWorldQuaternion(this.tmpQuaternion),c.getWorldPosition(this.tmpVector3),this.tmpBtVector3.setValue(this.tmpVector3.x,this.tmpVector3.y,this.tmpVector3.z),this.tmpBtQuaternion.setValue(this.tmpQuaternion.x,this.tmpQuaternion.y,this.tmpQuaternion.z,this.tmpQuaternion.w),this.tmpTrans.setOrigin(this.tmpBtVector3),this.tmpTrans.setRotation(this.tmpBtQuaternion),m.setWorldTransform(this.tmpTrans),c.body.needUpdate=!1;else{var l=this.tmpTrans.getOrigin(),u=this.tmpTrans.getRotation(),d=c.body.offset;c.position.set(l.x()+d.x,l.y()+d.y,l.z()+d.z),c.quaternion.set(u.x(),u.y(),u.z(),u.w())}c.body.collided=!1}}var p,h,f,y,b,v,g,w,x,V=function(){var t=P.dispatcher.getManifoldByIndexInternal(a),n=Object.keys(t.getBody0())[0],i=Ammo.castObject(t.getBody0(),Ammo.btRigidBody),s=Ammo.castObject(t.getBody1(),Ammo.btRigidBody);if(""===i.name&&""===s.name)return"continue";var c=i[n],m=s[n],l=P.objectsAmmo[c],u=P.objectsAmmo[m];if(!l||!u)return"continue";var d=l.body.breakable,A=u.body.breakable,V=l.body.collided,_=u.body.collided,C=null===(e=l.body)||void 0===e?void 0:e.checkCollisions,O=null===(o=u.body)||void 0===o?void 0:o.checkCollisions;if(C||O){var M=[l.name,u.name].sort(),S=M[0]+"__"+M[1],B=void 0;B=P.earlierDetectedCollisions.find((function(t){return t.combinedName===S}))?"colliding":"start",r.push({combinedName:S,collision:!0}),P.emit("collision",{bodies:[l,u],event:B})}if(!d&&!A||V&&_)return"continue";for(var E=!1,j=0,D=0,T=t.getNumContacts();D<T;D++)if((p=t.getContactPoint(D)).getDistance()<0){E=!0,(h=p.getAppliedImpulse())>j&&(j=h,f=p.get_m_positionWorldOnB(),y=p.get_m_normalWorldOnB(),P.impactPoint.set(f.x(),f.y(),f.z()),P.impactNormal.set(y.x(),y.y(),y.z()));break}if(!E)return"continue";if(P.emptyV3.set(0,0,0),l.userData={mass:1,velocity:P.emptyV3,angularVelocity:P.emptyV3,breakable:d,physicsBody:i},u.userData={mass:1,velocity:P.emptyV3,angularVelocity:P.emptyV3,breakable:A,physicsBody:s},void 0===l.fragmentDepth&&(l.fragmentDepth=0),void 0===u.fragmentDepth&&(u.fragmentDepth=0),d&&!V&&j>5&&l.fragmentDepth<2){b=P.convexBreaker.subdivideByImpact(l,P.impactPoint,P.impactNormal,1,2),v=b.length;for(D=0;D<v;D++)g=i.getLinearVelocity(),w=i.getAngularVelocity(),(x=b[D]).userData.velocity.set(g.x(),g.y(),g.z()),x.userData.angularVelocity.set(w.x(),w.y(),w.z()),P.createDebrisFromBreakableObject(x,l);P.objectsToRemove[P.numObjectsToRemove++]=l,l.body.collided=!0}if(A&&!_&&j>5&&u.fragmentDepth<2){b=P.convexBreaker.subdivideByImpact(u,P.impactPoint,P.impactNormal,1,2),v=b.length;for(D=0;D<v;D++)g=s.getLinearVelocity(),w=s.getAngularVelocity(),(x=b[D]).userData.velocity.set(g.x(),g.y(),g.z()),x.userData.angularVelocity.set(w.x(),w.y(),w.z()),P.createDebrisFromBreakableObject(x,u);P.objectsToRemove[P.numObjectsToRemove++]=u,u.body.collided=!0}},P=this;for(a=0,s=this.dispatcher.getNumManifolds();a<s;a++)V();for(a=0;a<this.numObjectsToRemove;a++)this.removeDebris(this.objectsToRemove[a]);this.numObjectsToRemove=0,this.earlierDetectedCollisions.forEach((function(t){var e=t.combinedName;if(!r.find((function(t){return t.combinedName===e}))){var o=e.split("__"),i=n.rigidBodies.find((function(t){return t.name===o[0]})),a=n.rigidBodies.find((function(t){return t.name===o[1]}));i&&a&&n.emit("collision",{bodies:[i,a],event:"end"})}})),this.earlierDetectedCollisions=A(r)},e}(s.a),P=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),_=function(t){function e(){var e=t.call(this)||this;return e.vector3=new f.Vector3,e.hasBody=!1,e.anims={},e.currentAnimation="",e.name="object-"+e.id,e}return P(e,t),Object.defineProperty(e.prototype,"world",{get:function(){return{theta:this.worldTheta,phi:this.worldPhi}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldTheta",{get:function(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldPhi",{get:function(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)},enumerable:!0,configurable:!0}),e.prototype.setAction=function(t){var e;if(this.mixer&&this.anims.hasOwnProperty(t)){var o=null===(e=this.mixer)||void 0===e?void 0:e.clipAction(this.anims[t]);o.time=0,this.mixer.stopAllAction(),o.fadeIn(.5),o.play(),this.currentAnimation=t}else i("[Phaser3D] Can't set animation "+t)},e}(f.Object3D);
/**
 * @author       Kevin Lee (https://github.com/InfiniteLee)
 * @copyright    Copyright (c) 2019 Kevin Lee; Project Url: https://github.com/InfiniteLee/three-to-ammo
 * @license      {@link https://github.com/InfiniteLee/three-to-ammo/blob/master/LICENSE|MPL-2.0}
 */
const C="box",O="cylinder",M="sphere",S="capsule",B="cone",E="hull",j="hacd",D="vhacd",T="mesh",k="heightfield",z="all",L="manual",H=_.prototype.hasOwnProperty("updateMatrices"),I=function(t,e){switch(e.type){case C:return R(t,e);case O:return F(t,e);case S:return W(t,e);case B:return N(t,e);case M:return G(t,e);case E:return U(t,e);case j:return X(t,e);case D:return q(t,e);case T:return Q(t,e);case k:return Y(t,e);default:return i(e.type+" is not currently supported"),[]}},R=function(t,e){e.type=C,Z(e),e.fit===z&&(e.halfExtents=et(t,ot(t,e),e.minHalfExtent,e.maxHalfExtent));const o=new Ammo.btVector3(e.halfExtents.x,e.halfExtents.y,e.halfExtents.z),n=new Ammo.btBoxShape(o);return Ammo.destroy(o),$(n,e,J(t,e)),n},F=function(t,e){e.type=O,Z(e),e.fit===z&&(e.halfExtents=et(t,ot(t,e),e.minHalfExtent,e.maxHalfExtent));const o=new Ammo.btVector3(e.halfExtents.x,e.halfExtents.y,e.halfExtents.z),n=(()=>{switch(e.cylinderAxis){case"y":return new Ammo.btCylinderShape(o);case"x":return new Ammo.btCylinderShapeX(o);case"z":return new Ammo.btCylinderShapeZ(o)}return null})();return Ammo.destroy(o),$(n,e,J(t,e)),n},W=function(t,e){e.type=S,Z(e),e.fit===z&&(e.halfExtents=et(t,ot(t,e),e.minHalfExtent,e.maxHalfExtent));const{x:o,y:n,z:r}=e.halfExtents,i=(()=>{switch(e.cylinderAxis){case"y":return new Ammo.btCapsuleShape(Math.max(o,r),2*n);case"x":return new Ammo.btCapsuleShapeX(Math.max(n,r),2*o);case"z":return new Ammo.btCapsuleShapeZ(Math.max(o,n),2*r)}return null})();return $(i,e,J(t,e)),i},N=function(t,e){e.type=B,Z(e),e.fit===z&&(e.halfExtents=et(t,ot(t,e),e.minHalfExtent,e.maxHalfExtent));const{x:o,y:n,z:r}=e.halfExtents,i=(()=>{switch(e.cylinderAxis){case"y":return new Ammo.btConeShape(Math.max(o,r),2*n);case"x":return new Ammo.btConeShapeX(Math.max(n,r),2*o);case"z":return new Ammo.btConeShapeZ(Math.max(o,n),2*r)}return null})();return $(i,e,J(t,e)),i},G=function(t,e){let o;e.type=M,Z(e),o=e.fit!==L||isNaN(e.sphereRadius)?tt(t,e,ot(t,e)):e.sphereRadius;const n=new Ammo.btSphereShape(o);return $(n,e,J(t,e)),n},U=function(){const t=new f.Vector3,e=new f.Vector3;return function(o,n){if(n.type=E,Z(n),n.fit===L)return console.warn("cannot use fit: manual with type: hull"),null;const r=ot(o,n),i=new Ammo.btVector3,a=new Ammo.btConvexHullShape;a.setMargin(n.margin),e.addVectors(r.max,r.min).multiplyScalar(.5);let s=0;K(o,n,t=>{s+=t.attributes.position.array.length/3});const c=n.hullMaxVertices||1e5;s>c&&console.warn(`too many vertices for hull shape; sampling ~${c} from ~${s} vertices`);const m=Math.min(1,c/s);K(o,n,(o,n)=>{nt(o,n);const r=o.attributes.position.array;for(let o=0;o<r.length;o+=3)Math.random()<=m&&(t.set(r[o],r[o+1],r[o+2]).applyMatrix4(n).sub(e),i.setValue(t.x,t.y,t.z),a.addPoint(i,o===r.length-3))});let l=a;if(a.getNumVertices()>=100){const t=new Ammo.btShapeHull(a);t.buildHull(n.margin),Ammo.destroy(a),l=new Ammo.btConvexHullShape(Ammo.getPointer(t.getVertexPointer()),t.numVertices()),Ammo.destroy(t)}return Ammo.destroy(i),$(l,n,J(o,n)),l}}(),X=function(){const t=new f.Vector3,e=new f.Vector3;return function(o,n){if(n.type=j,Z(n),n.fit===L)return console.warn("cannot use fit: manual with type: hacd"),[];if(!Ammo.hasOwnProperty("HACD"))return console.warn("HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const r=ot(o),i=J(o,n);let a=0,s=0;e.addVectors(r.max,r.min).multiplyScalar(.5),K(o,n,t=>{a+=t.attributes.position.array.length/3,t.index?s+=t.index.array.length/3:s+=t.attributes.position.array.length/9});const c=new Ammo.HACD;n.hasOwnProperty("compacityWeight")&&c.SetCompacityWeight(n.compacityWeight),n.hasOwnProperty("volumeWeight")&&c.SetVolumeWeight(n.volumeWeight),n.hasOwnProperty("nClusters")&&c.SetNClusters(n.nClusters),n.hasOwnProperty("nVerticesPerCH")&&c.SetNVerticesPerCH(n.nVerticesPerCH),n.hasOwnProperty("concavity")&&c.SetConcavity(n.concavity);const m=Ammo._malloc(3*a*8),l=Ammo._malloc(3*s*4);c.SetPoints(m),c.SetTriangles(l),c.SetNPoints(a),c.SetNTriangles(s);const u=m/8,d=l/4;K(o,n,(o,n)=>{nt(o,n);const r=o.attributes.position.array,i=o.index?o.index.array:null;for(let o=0;o<r.length;o+=3)t.set(r[o+0],r[o+1],r[o+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[u+o+0]=t.x,Ammo.HEAPF64[u+o+1]=t.y,Ammo.HEAPF64[u+o+2]=t.z;if(i)for(let t=0;t<i.length;t++)Ammo.HEAP32[d+t]=i[t];else for(let t=0;t<r.length/3;t++)Ammo.HEAP32[d+t]=t}),c.Compute(),Ammo._free(m),Ammo._free(l);const p=c.GetNClusters(),h=[];for(let t=0;t<p;t++){const e=new Ammo.btConvexHullShape;e.setMargin(n.margin);const o=c.GetNPointsCH(t),r=c.GetNTrianglesCH(t),a=Ammo._malloc(3*o*8),s=Ammo._malloc(3*r*4);c.GetCH(t,a,s);const m=a/8;for(let t=0;t<o;t++){const n=new Ammo.btVector3,r=Ammo.HEAPF64[m+3*t+0],i=Ammo.HEAPF64[m+3*t+1],a=Ammo.HEAPF64[m+3*t+2];n.setValue(r,i,a),e.addPoint(n,t===o-1),Ammo.destroy(n)}$(e,n,i),h.push(e)}return h}}(),q=function(){const t=new f.Vector3,e=new f.Vector3;return function(o,n){if(n.type=D,Z(n),n.fit===L)return console.warn("cannot use fit: manual with type: vhacd"),[];if(!Ammo.hasOwnProperty("VHACD"))return console.warn("VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version."),[];const r=ot(o,n),i=J(o,n);let a=0,s=0;e.addVectors(r.max,r.min).multiplyScalar(.5),K(o,n,t=>{a+=t.attributes.position.count,t.index?s+=t.index.count/3:s+=t.attributes.position.count/3});const c=new Ammo.VHACD,m=new Ammo.Parameters;n.hasOwnProperty("resolution")&&m.set_m_resolution(n.resolution),n.hasOwnProperty("depth")&&m.set_m_depth(n.depth),n.hasOwnProperty("concavity")&&m.set_m_concavity(n.concavity),n.hasOwnProperty("planeDownsampling")&&m.set_m_planeDownsampling(n.planeDownsampling),n.hasOwnProperty("convexhullDownsampling")&&m.set_m_convexhullDownsampling(n.convexhullDownsampling),n.hasOwnProperty("alpha")&&m.set_m_alpha(n.alpha),n.hasOwnProperty("beta")&&m.set_m_beta(n.beta),n.hasOwnProperty("gamma")&&m.set_m_gamma(n.gamma),n.hasOwnProperty("pca")&&m.set_m_pca(n.pca),n.hasOwnProperty("mode")&&m.set_m_mode(n.mode),n.hasOwnProperty("maxNumVerticesPerCH")&&m.set_m_maxNumVerticesPerCH(n.maxNumVerticesPerCH),n.hasOwnProperty("minVolumePerCH")&&m.set_m_minVolumePerCH(n.minVolumePerCH),n.hasOwnProperty("convexhullApproximation")&&m.set_m_convexhullApproximation(n.convexhullApproximation),n.hasOwnProperty("oclAcceleration")&&m.set_m_oclAcceleration(n.oclAcceleration);const l=Ammo._malloc(3*a*8),u=Ammo._malloc(3*s*4);let d=l/8,p=u/4;K(o,n,(o,n)=>{nt(o,n);const r=o.attributes.position.array,i=o.index?o.index.array:null;for(let o=0;o<r.length;o+=3)t.set(r[o+0],r[o+1],r[o+2]).applyMatrix4(n).sub(e),Ammo.HEAPF64[d+0]=t.x,Ammo.HEAPF64[d+1]=t.y,Ammo.HEAPF64[d+2]=t.z,d+=3;if(i)for(let t=0;t<i.length;t++)Ammo.HEAP32[p]=i[t],p++;else for(let t=0;t<r.length/3;t++)Ammo.HEAP32[p]=t,p++}),c.Compute(l,3,a,u,3,s,m),Ammo._free(l),Ammo._free(u);const h=c.GetNConvexHulls(),f=[],y=new Ammo.ConvexHull;for(let t=0;t<h;t++){c.GetConvexHull(t,y);const e=y.get_m_nPoints(),o=(y.get_m_points(),new Ammo.btConvexHullShape);o.setMargin(n.margin);for(let t=0;t<e;t++){const n=new Ammo.btVector3,r=y.get_m_points(3*t+0),i=y.get_m_points(3*t+1),a=y.get_m_points(3*t+2);n.setValue(r,i,a),o.addPoint(n,t===e-1),Ammo.destroy(n)}$(o,n,i),f.push(o)}return Ammo.destroy(y),Ammo.destroy(c),f}}(),Q=function(){const t=new f.Vector3,e=new f.Vector3,o=new f.Vector3;return function(n,r){if(r.type=T,Z(r),r.fit===L)return console.warn("cannot use fit: manual with type: mesh"),null;const i=J(n,r),a=new Ammo.btVector3,s=new Ammo.btVector3,c=new Ammo.btVector3,m=new Ammo.btTriangleMesh(!0,!1);let l;return K(n,r,(n,r)=>{const i=n.attributes.position.array;if(n.index)for(let l=0;l<n.index.count;l+=3){const u=3*n.index.array[l],d=3*n.index.array[l+1],p=3*n.index.array[l+2];t.set(i[u],i[u+1],i[u+2]).applyMatrix4(r),e.set(i[d],i[d+1],i[d+2]).applyMatrix4(r),o.set(i[p],i[p+1],i[p+2]).applyMatrix4(r),a.setValue(t.x,t.y,t.z),s.setValue(e.x,e.y,e.z),c.setValue(o.x,o.y,o.z),m.addTriangle(a,s,c,!1)}else for(let n=0;n<i.length;n+=9)t.set(i[n+0],i[n+1],i[n+2]).applyMatrix4(r),e.set(i[n+3],i[n+4],i[n+5]).applyMatrix4(r),o.set(i[n+6],i[n+7],i[n+8]).applyMatrix4(r),a.setValue(t.x,t.y,t.z),s.setValue(e.x,e.y,e.z),c.setValue(o.x,o.y,o.z),m.addTriangle(a,s,c,!1)}),l=r.concave?new Ammo.btBvhTriangleMeshShape(m,!0,!0):new Ammo.btConvexTriangleMeshShape(m,!0),l.resources=[m],Ammo.destroy(a),Ammo.destroy(s),Ammo.destroy(c),$(l,r,i),l}}(),Y=function(t,e){if(Z(e),e.fit===z)return console.warn("cannot use fit: all with type: heightfield"),null;const o=e.heightfieldDistance||1,n=e.heightfieldData||[],r=e.heightScale||0,i=e.hasOwnProperty("upAxis")?e.upAxis:1,a=(()=>{switch(e.heightDataType){case"short":return Ammo.PHY_SHORT;case"float":default:return Ammo.PHY_FLOAT}})(),s=!e.hasOwnProperty("flipQuadEdges")||e.flipQuadEdges,c=n.length,m=c>0?n[0].length:0,l=Ammo._malloc(c*m*4),u=l/4;let d=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,h=0;for(let t=0;t<c;t++)for(let e=0;e<m;e++){const o=n[t][e];Ammo.HEAPF32[u+h]=o,h++,d=Math.min(d,o),p=Math.max(p,o)}const f=new Ammo.btHeightfieldTerrainShape(m,c,l,r,d,p,i,a,s),y=new Ammo.btVector3(o,1,o);return f.setLocalScaling(y),Ammo.destroy(y),f.heightfieldData=l,$(f,e),f};function Z(t){t.fit=t.hasOwnProperty("fit")?t.fit:z,t.type=t.type||E,t.minHalfExtent=t.hasOwnProperty("minHalfExtent")?t.minHalfExtent:0,t.maxHalfExtent=t.hasOwnProperty("maxHalfExtent")?t.maxHalfExtent:Number.POSITIVE_INFINITY,t.cylinderAxis=t.cylinderAxis||"y",t.margin=t.hasOwnProperty("margin")?t.margin:.05,t.includeInvisible=!!t.hasOwnProperty("includeInvisible")&&t.includeInvisible,t.offset||(t.offset=new f.Vector3),t.orientation||(t.orientation=new f.Quaternion)}const $=function(t,e,o){if(t.type=e.type,t.setMargin(e.margin),t.destroy=()=>{for(let e of t.resources||[])Ammo.destroy(e);t.heightfieldData&&Ammo._free(t.heightfieldData),Ammo.destroy(t)},o){const e=new Ammo.btVector3(o.x,o.y,o.z);t.setLocalScaling(e),Ammo.destroy(e)}},K=function(){const t=new f.Matrix4,e=new f.Matrix4,o=new f.BufferGeometry;return function(n,r,i){e.getInverse(n.matrixWorld),n.traverse(r=>{r.isMesh&&(r===n?t.identity():(H&&r.updateMatrices(),t.multiplyMatrices(e,r.matrixWorld)),i(r.geometry.isBufferGeometry?r.geometry:o.fromGeometry(r.geometry),t))})}}(),J=function(t,e){const{scale:o}=t;return o},tt=function(){const t=new f.Vector3,e=new f.Vector3;return function(o,n,r){let i=0,{x:a,y:s,z:c}=r.getCenter(e);return K(o,n,(e,o)=>{const n=e.attributes.position.array;for(let e=0;e<n.length;e+=3){t.set(n[e],n[e+1],n[e+2]).applyMatrix4(o);const r=a-t.x,m=s-t.y,l=c-t.z;i=Math.max(i,r*r+m*m+l*l)}}),Math.sqrt(i)}}(),et=function(t,e,o,n){return(new f.Vector3).subVectors(e.max,e.min).multiplyScalar(.5).clampScalar(o,n)},ot=function(){const t=new f.Vector3;return function(e,o){const n=new f.Box3;let r=1/0,i=1/0,a=1/0,s=-1/0,c=-1/0,m=-1/0;return n.min.set(0,0,0),n.max.set(0,0,0),K(e,o,(e,o)=>{const n=e.attributes.position.array;for(let e=0;e<n.length;e+=3)t.set(n[e],n[e+1],n[e+2]).applyMatrix4(o),t.x<r&&(r=t.x),t.y<i&&(i=t.y),t.z<a&&(a=t.z),t.x>s&&(s=t.x),t.y>c&&(c=t.y),t.z>m&&(m=t.z)}),n.min.set(r,i,a),n.max.set(s,c,m),n}}(),nt=(t,e)=>{t.computeBoundingBox();const o=new f.Vector3;t.boundingBox.getCenter(o),e.makeTranslation(o.x,o.y,o.z)};
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/yandeu/enable3d
 * @license      {@link https://github.com/yandeu/enable3d/blob/master/LICENSE|GNU GPLv3}
 */
var rt=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),it=function(t){function e(e,o){var n=t.call(this,e,o)||this;return n.vector3=new f.Vector3,n.hasBody=!1,n.anims={},n.currentAnimation="",n.name="object-"+n.id,n}return rt(e,t),Object.defineProperty(e.prototype,"world",{get:function(){return{theta:this.worldTheta,phi:this.worldPhi}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldTheta",{get:function(){return this.getWorldDirection(this.vector3),Math.atan2(this.vector3.x,this.vector3.z)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"worldPhi",{get:function(){return this.getWorldDirection(this.vector3),Math.acos(this.vector3.y)},enumerable:!0,configurable:!0}),e.prototype.setAction=function(t){var e;if(this.mixer&&this.anims.hasOwnProperty(t)){var o=null===(e=this.mixer)||void 0===e?void 0:e.clipAction(this.anims[t]);o.time=0,this.mixer.stopAllAction(),o.fadeIn(.5),o.play(),this.currentAnimation=t}else i("[Phaser3D] Can't set animation "+t)},e}(f.Mesh),at=function(){function t(){this._defaultMaterial=new f.MeshLambertMaterial({color:13421772})}return t.prototype.get=function(){return this._defaultMaterial},t}(),st=function(){return(st=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},ct=function(t,e){var o={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(o[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(t,n[r])&&(o[n[r]]=t[n[r]])}return o},mt=function(){function t(t){this.scene=t,this.defaultMaterial=new at}return t.prototype.addMesh=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++)this.scene.add(t[e]);else this.scene.add(t);return this},t.prototype.createMesh=function(t,e,o){var n,r=o.x,i=void 0===r?0:r,a=o.y,s=void 0===a?0:a,c=o.z,m=void 0===c?0:c;switch(!Array.isArray(e)&&e.type){case"LineBasicMaterial":n=new f.Line(t,e);break;case"PointsMaterial":n=new f.Points(t,e);break;default:n=new it(t,e)}return n.position.set(i,s,m),n.castShadow=n.receiveShadow=!0,n},t.prototype.makeExtrude=function(t,e){var o=t.x,n=t.y,r=t.z,i=t.name,a=t.shape,s=t.autoCenter,c=void 0===s||s,m=t.breakable,l=void 0!==m&&m,u=t.bufferGeometry,d=void 0===u||u,p=ct(t,["x","y","z","name","shape","autoCenter","breakable","bufferGeometry"]),h=p.depth,y=void 0===h?1:h,b=p.bevelEnabled,v=void 0!==b&&b,g=d||l?new f.ExtrudeBufferGeometry(a,st({depth:y,bevelEnabled:v},p)):new f.ExtrudeGeometry(a,st({depth:y,bevelEnabled:v},p)),w=this.addMaterial(e),x=this.createMesh(g,w,{x:o,y:n,z:r});return c&&x.geometry.center(),x.name=i||"body_id_"+x.id,x.shape="extrude",x},t.prototype.addExtrude=function(t,e){void 0===e&&(e={});var o=this.makeExtrude(t,e);return this.scene.add(o),o},t.prototype.makeSphere=function(t,e){var o=t.x,n=t.y,r=t.z,i=t.name,a=t.breakable,s=void 0!==a&&a,c=t.bufferGeometry,m=void 0===c||c,l=ct(t,["x","y","z","name","breakable","bufferGeometry"]),u=m||s?new f.SphereBufferGeometry(l.radius||1,l.widthSegments||16,l.heightSegments||12,l.phiStart||void 0,l.phiLength||void 0,l.thetaStart||void 0,l.thetaLength||void 0):new f.SphereGeometry(l.radius||1,l.widthSegments||16,l.heightSegments||12,l.phiStart||void 0,l.phiLength||void 0,l.thetaStart||void 0,l.thetaLength||void 0),d=this.addMaterial(e),p=this.createMesh(u,d,{x:o,y:n,z:r});return p.name=i||"body_id_"+p.id,p.shape="sphere",p},t.prototype.addSphere=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeSphere(t,e);return this.scene.add(o),o},t.prototype.makeBox=function(t,e){var o=t.x,n=t.y,r=t.z,i=t.name,a=t.breakable,s=void 0!==a&&a,c=t.bufferGeometry,m=void 0===c||c,l=ct(t,["x","y","z","name","breakable","bufferGeometry"]),u=m||s?new f.BoxBufferGeometry(l.width||1,l.height||1,l.depth||1,l.widthSegments||void 0,l.heightSegments||void 0,l.depthSegments||void 0):new f.BoxGeometry(l.width||1,l.height||1,l.depth||1,l.widthSegments||void 0,l.heightSegments||void 0,l.depthSegments||void 0),d=this.addMaterial(e),p=this.createMesh(u,d,{x:o,y:n,z:r});return p.name=i||"body_id_"+p.id,p.shape="box",p},t.prototype.addBox=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeBox(t,e);return this.scene.add(o),o},t.prototype.addGround=function(t,e){void 0===e&&(e={});var o=this.makeBox(t,e);return o.rotateX(f.MathUtils.degToRad(90)),this.scene.add(o),o},t.prototype.makeCylinder=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=t.x,n=t.y,r=t.z,i=t.name,a=t.breakable,s=void 0!==a&&a,c=t.bufferGeometry,m=void 0===c||c,l=ct(t,["x","y","z","name","breakable","bufferGeometry"]),u=m||s?new f.CylinderBufferGeometry(l.radiusTop||1,l.radiusBottom||1,l.height||1,l.radiusSegments||void 0,l.heightSegments||void 0,l.openEnded||void 0,l.thetaStart||void 0,l.thetaLength||void 0):new f.CylinderGeometry(l.radiusTop||1,l.radiusBottom||1,l.height||1,l.radiusSegments||void 0,l.heightSegments||void 0,l.openEnded||void 0,l.thetaStart||void 0,l.thetaLength||void 0),d=this.addMaterial(e),p=this.createMesh(u,d,{x:o,y:n,z:r});return p.name=i||"body_id_"+p.id,p.shape="cylinder",p},t.prototype.addCylinder=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeCylinder(t,e);return this.scene.add(o),o},t.prototype.makeTorus=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=t.x,n=t.y,r=t.z,i=t.name,a=t.breakable,s=void 0!==a&&a,c=t.bufferGeometry,m=void 0===c||c,l=ct(t,["x","y","z","name","breakable","bufferGeometry"]),u=m||s?new f.TorusBufferGeometry(l.radius||void 0,l.tube||void 0,l.radialSegments||void 0,l.tubularSegments||void 0,l.arc||void 0):new f.TorusGeometry(l.radius||void 0,l.tube||void 0,l.radialSegments||void 0,l.tubularSegments||void 0,l.arc||void 0),d=this.addMaterial(e),p=this.createMesh(u,d,{x:o,y:n,z:r});return p.name=i||"body_id_"+p.id,p.shape="torus",p},t.prototype.addTorus=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});var o=this.makeTorus(t,e);return this.scene.add(o),o},t.prototype.addMaterial=function(t){var e;switch(void 0===t&&(t={}),Object.keys(t)[0]){case"basic":e=new f.MeshBasicMaterial(t.basic);break;case"normal":e=new f.MeshNormalMaterial(t.normal);break;case"standard":e=new f.MeshStandardMaterial(t.standard);break;case"lambert":e=new f.MeshLambertMaterial(t.lambert);break;case"phong":e=new f.MeshPhongMaterial(t.phong);break;case"physical":void 0!==t.physical?e=new f.MeshPhysicalMaterial(t.physical):(i("You need to pass parameters to the physical material. (Fallback to default material)"),e=this.defaultMaterial.get());break;case"toon":e=new f.MeshToonMaterial(t.toon);break;case"line":e=new f.LineBasicMaterial(t.line);break;case"points":e=new f.PointsMaterial(t.points);break;case"custom":e=t.custom||this.defaultMaterial.get();break;default:e=this.defaultMaterial.get()}return e},t}(),lt=function(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){var t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1}(),ut=function(t,e){var o=document.createElement("script");o.onload=function(){e()},o.onerror=function(){throw new Error("failed to load "+t)},o.async=!0,o.src=t,document.head.appendChild(o)},dt=function(t,e){ut(lt?t+"/ammo.wasm.js":t+"/ammo.js",(function(){return e()}))},pt=function(t,e){window.__loadPhysics=!0,dt(t,(function(){Ammo().then((function(){e()}))}))},ht=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),ft=function(){return(ft=Object.assign||function(t){for(var e,o=1,n=arguments.length;o<n;o++)for(var r in e=arguments[o])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},yt=function(){for(var t=0,e=0,o=arguments.length;e<o;e++)t+=arguments[e].length;var n=Array(t),r=0;for(e=0;e<o;e++)for(var i=arguments[e],a=0,s=i.length;a<s;a++,r++)n[r]=i[a];return n},bt=function(t){function e(e,o){void 0===o&&(o={});var n=t.call(this)||this;n.scene=e,n.config=o,n.rigidBodies=[],n.objectsAmmo={},n.earlierDetectedCollisions=[],n.tmpEuler=new f.Euler,n.tmpQuaternion=new f.Quaternion,n.tmpVector3=new f.Vector3,n.tmpBtVector3=new Ammo.btVector3,n.tmpBtQuaternion=new Ammo.btQuaternion(0,0,0,1),n.defaultMaterial=new at;var r="three.js version "+f.REVISION;return console.log("%c %c %c %c %c "+r+" %c https://threejs.org/","background: #ff0000","background: #ffff00","background: #00ff00","background: #00ffff","color: #fff; background: #000000;","background: none"),n.factory=new mt(e),n.emptyV3=new f.Vector3,n.impactPoint=new f.Vector3,n.impactNormal=new f.Vector3,n.gravity=o.gravity||{x:0,y:-9.81,z:0},n.start(),n}return ht(e,t),Object.defineProperty(e.prototype,"debug",{get:function(){var t=this;return{enable:function(){t.debugDrawer.enable()},mode:function(e){void 0===e&&(e=1),t.debugDrawer.setDebugMode(e)},disable:function(){t.debugDrawer.disable()}}},enumerable:!0,configurable:!0}),e.prototype.start=function(){var t=this;"undefined"!=typeof Ammo?"function"==typeof Ammo?Ammo().then((function(){t.setup()})):this.setup():i("Are you sure you included ammo.js?")},Object.defineProperty(e.prototype,"add",{get:function(){var t=this;return{collider:function(e,o,n){return t.addCollider(e,o,n)},constraints:this.addConstraints,existing:function(e,o){return t.addExisting(e,o)},sphere:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addSphere(e,o)},ground:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addGround(e,o)},box:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addBox(e,o)},cylinder:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addCylinder(e,o)},torus:function(e,o){return void 0===e&&(e={}),void 0===o&&(o={}),t.addTorus(e,o)},extrude:function(e,o){return void 0===o&&(o={}),t.addExtrude(e,o)}}},enumerable:!0,configurable:!0}),e.prototype.addCompoundShape=function(t){var e=new Ammo.btCompoundShape;return t.forEach((function(o,n){var r,i=new Ammo.btTransform,a=new f.Vector3(o.x||0,o.y||0,o.z||0);if(null===(r=o.tmp)||void 0===r?void 0:r.offset){var s=o.tmp.offset;a.add(new f.Vector3(s.x,s.y,s.z))}i.setIdentity(),i.setOrigin(new Ammo.btVector3(a.x||0,a.y||0,a.z||0)),e.addChildShape(i,t[n])})),e},e.prototype.addExisting=function(t,e){var o,n,r=this;void 0===e&&(e={});var a=t.position,s=t.quaternion,c=t.hasBody,m=e.mass,l=void 0===m?1:m,u=e.autoCenter,d=void 0!==u&&u,p=e.offset,h=void 0===p?void 0:p,f=e.shapes,y=void 0===f?[]:f,b=e.breakable,v=void 0!==b&&b,g=e.addRigidBody,w=void 0===g||g,x={width:1,height:1,depth:1,radius:1,radiusTop:1,radiusBottom:1,tube:.4,tubularSegments:6},A=[];t.children.length>=1&&t.children.forEach((function(t){var e=r.addExisting(t,{addRigidBody:!1});e.tmp={offset:t.position.clone()},A.push(e)}));var V="box",P=t.geometry.type;/box/i.test(P)?V="box":/cone/i.test(P)?V="cone":/cylinder/i.test(P)?V="cylinder":/extrude/i.test(P)?V="extrude":/plane/i.test(P)?V="plane":/sphere/i.test(P)?V="sphere":/torus/i.test(P)&&(V="torus");var _={};if(e.shape?(_=ft(ft({},x),e),V=e.shape):t.shape?(_=ft(ft({},x),null===(o=null==t?void 0:t.geometry)||void 0===o?void 0:o.parameters),V=t.shape):_=ft(ft({},x),null===(n=null==t?void 0:t.geometry)||void 0===n?void 0:n.parameters),Object.keys(_).forEach((function(t){void 0===_[t]&&x[t]&&(_[t]=x[t])})),c)i('Object "'+t.name+'" already has a physical body!');else{var C;if(d&&t.geometry.center(),"extrude"===V&&(V="hacd"),"mesh"!==V&&"convex"!==V||(V="convexMesh"),"concave"===V&&(V="concaveMesh"),y.length>0){var O=[];y.forEach((function(t){O.push(r.addShape({shape:t.shape,params:ft({},t)}))})),C=this.addCompoundShape(O)}else C=this.addShape({shape:V,shapes:y,params:_,object:t,quat:s});if(C){if(C.setMargin(.05),A.length>=1&&(C=this.addCompoundShape(yt([C],A))),!w)return C;this.addRigidBodyToShape(t,C,{mass:l,pos:a,quat:s,breakable:v,offset:h,config:e})}else i('Could not recognize shape "'+V+'"!')}},e.prototype.addRigidBodyToShape=function(t,e,o){var n=o.mass,r=void 0===n?1:n,i=o.pos,a=void 0===i?new f.Vector3(0,0,0):i,s=o.quat,c=void 0===s?new f.Quaternion(0,0,0,1):s,m=o.breakable,l=void 0!==m&&m,u=o.offset,d=void 0===u?{x:0,y:0,z:0}:u,p=o.config,h=void 0===p?{}:p;this.addRigidBody(t,e,r,a,c),this.addBodyProperties(t,h),l&&(t.body.breakable=!0),d&&(t.body.offset=ft({x:0,y:0,z:0},d))},e.prototype.addShape=function(t){var e,o=t.shape,n=t.object,r=t.params,i=t.quat;switch(o){case"box":e=new Ammo.btBoxShape(new Ammo.btVector3(r.width/2,r.height/2,r.depth/2));break;case"sphere":e=new Ammo.btSphereShape(r.radius);break;case"cylinder":e=new Ammo.btCylinderShape(new Ammo.btVector3(r.radiusTop,r.height/2,0));break;case"torus":e=function(t,e){var o=t.radius,n=void 0===o?1:o,r=t.tube,i=void 0===r?.4:r,a=t.tubularSegments,s=void 0===a?8:a,c=Math.PI,m=s,l=Math.sqrt(2*i*i-2*i*i*Math.cos(2*c/m)),u=new Ammo.btVector3(i,c/m+.5*l,i),d=new Ammo.btCylinderShape(u);d.setMargin(.05);for(var p=new Ammo.btCompoundShape,h=new Ammo.btVector3(0,0,1),f=new Ammo.btVector3(0,n,0),y=new Ammo.btQuaternion(e.x,e.y,e.z,e.w),b=0;b<m;b++){var v=2*b*c/m,g=f.rotate(h,v),w=new Ammo.btTransform;y.setRotation(h,v+Math.PI/2),w.setIdentity(),w.setOrigin(g),w.setRotation(y),p.addChildShape(w,d)}return p}(r,i);break;case"hull":e=I(n,{type:"hull"});break;case"hacd":e=I(n,{type:"hacd"});break;case"vhacd":e=I(n,{type:"vhacd"});break;case"convexMesh":e=I(n,{type:"mesh",concave:!1});break;case"concaveMesh":e=I(n,{type:"mesh",concave:!0})}if(Array.isArray(e)){var a=new Ammo.btCompoundShape;e.forEach((function(t){var e=new Ammo.btTransform;e.setIdentity(),a.addChildShape(e,t)})),e=a}return e},e.prototype.createRigidBody=function(t,e,o,n){var r=new Ammo.btTransform;r.setIdentity(),r.setOrigin(new Ammo.btVector3(o.x,o.y,o.z)),r.setRotation(new Ammo.btQuaternion(n.x,n.y,n.z,n.w));var i=new Ammo.btDefaultMotionState(r),a=new Ammo.btVector3(0,0,0);e>0&&t.calculateLocalInertia(e,a);var s=new Ammo.btRigidBodyConstructionInfo(e,i,t,a);return new Ammo.btRigidBody(s)},e.prototype.addRigidBody=function(t,e,o,n,r,i){t.position.copy(n),t.quaternion.copy(r);var a=this.createRigidBody(e,o,n,r);if(i){var s=new Ammo.btVector3(i.x,i.y,i.z);e.setLocalScaling(s),Ammo.destroy(s)}o>0&&a.setActivationState(4),this.rigidBodies.push(t),this.physicsWorld.addRigidBody(a);var m=Object.values(a)[0];a.name=t.name,t.body=new c(this,a),t.hasBody=!0,t.ptr=m,this.objectsAmmo[m]=t},e.prototype.addBodyProperties=function(t,e){var o=e.friction,n=void 0===o?.5:o,r=e.collisionFlags,i=void 0===r?0:r;t.body.setCollisionFlags(i),t.body.setFriction(n)},e}(s.a);
/**
 * @author       Yannick Deubel (https://github.com/yandeu)
 * @copyright    Copyright (c) 2020 Yannick Deubel; Project Url: https://github.com/yandeu/enable3d
 * @license      {@link https://github.com/yandeu/enable3d/blob/master/LICENSE|GNU GPLv3}
 */m(bt,[V,d,u,h]),o.d(e,"PhysicsLoader",(function(){return pt})),o.d(e,"AmmoPhysics",(function(){return bt}))}])}));
//# sourceMappingURL=enable3d.ammoPhysics@0.0.14.min.js.map